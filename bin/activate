#!/usr/bin/env bash

deactivate () {
    if [[ -n "${_OLD_PATH:-}" ]] ; then
        export PATH="${_OLD_PATH:-}"
        unset _OLD_PATH
        unset VAULT_ADDR
    fi

    if [[ -n "${BASH:-}" || -n "${ZSH_VERSION:-}" ]] ; then
        hash -r
    fi

    if [[ ! "$1" = "nondestructive" ]] ; then
        unset -f deactivate
        unset -f get
        unset -f up
    fi
}

get () {
    go get -mod= $@
}

up () {
    get -u $@
    make deps-main
}

deactivate nondestructive

_OLD_PATH="${PATH}"
export PATH="$(cd `dirname ${0}` && pwd):${PATH}"
export VAULT_ADDR=http://127.0.0.1:8200

if [[ -n "${BASH:-}" || -n "${ZSH_VERSION:-}" ]] ; then
    hash -r
fi
