#!/usr/bin/env bash

deactivate () {
    if [[ -n "${_OLD_PATH:-}" ]] ; then
        export PATH="${_OLD_PATH:-}"
        unset _OLD_PATH
        unset VAULT_ADDR
    fi

    if [[ -n "${BASH:-}" || -n "${ZSH_VERSION:-}" ]] ; then
        hash -r
    fi

    if [[ ! "$1" = "nondestructive" ]] ; then
        unset -f deactivate
        unset -f realpath
        unset -f get
        unset -f up
    fi
}

realpath () {
    if [[ -z "${1:-}" ]]; then
        echo 'Please provide a file/dir name'
        return
    fi
    echo "$(cd `dirname ${1}` && pwd)/${1}"
}

get () {
    go get -mod= $@
}

up () {
    get -u $@
    make deps-main
}

deactivate nondestructive

_OLD_PATH="${PATH}"
export PATH="$(realpath $(dirname $0)):${PATH}"
export VAULT_ADDR=http://127.0.0.1:8200

if [[ -n "${BASH:-}" || -n "${ZSH_VERSION:-}" ]] ; then
    hash -r
fi
